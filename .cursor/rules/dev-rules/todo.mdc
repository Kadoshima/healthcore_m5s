---
description: 
globs: 
alwaysApply: false
---
 ---
description: M5StickC Plus 2開発ToDoリスト
globs: 
alwaysApply: false
---

# M5StickC Plus 2 歩行分析システム 開発ToDoリスト

## 優先度の定義
- 🔥 **高**: 最優先で取り組むべき課題（システム動作に不可欠）
- ⚡ **中**: 基本機能として重要だが、高優先度の後に対応可能
- 🌱 **低**: システム基盤が安定した後で実装する拡張・改善項目

## ステータス
- [ ] 未着手
- [~] 進行中
- [x] 完了
- [!] 問題あり（障害・ブロッカー）

---

## 既存バグ修正
- [~] 🔥 ボタン処理のクラッシュ問題解決（StickCP2.BtnA/BtnBの処理方法修正）
  - 一時的にシリアルコマンドでの操作に切り替え済み
  - M5Unifiedライブラリのボタン処理方法を調査中
- [~] 🔥 BMI270センサーの正しい初期化と読み取り方法実装
  - M5StickCPlus2ライブラリでの正しいIMU初期化方法を実装中
- [ ] 🔥 `M5`と`StickCP2`の参照混在による問題の修正

## 基本機能実装
- [ ] 🔥 歩行検出機能の復活
  - タスク: 正規化と加速度振幅からのステップ検出アルゴリズム実装
- [ ] 🔥 BPM計算と表示機能の復活
  - タスク: ステップ間隔からのBPM計算
  - タスク: 画面へのBPM数値表示
- [ ] ⚡ グラフ表示機能の復活
  - タスク: 加速度波形のリアルタイムグラフ描画
- [ ] ⚡ Bluetooth送信機能の復活
  - タスク: BluetoothシリアルのBPM・加速度データ送信
- [ ] ⚡ 正しいボタン処理の実装
  - タスク: A/Bボタンの正しいハンドリング方法実装

## 拡張機能
- [ ] 🌱 クリック音によるリズム提示機能
  - タスク: スピーカーからのビープ音生成
  - タスク: BPMに連動したテンポ制御
- [ ] 🌱 BPMコントロール（リズム誘導）機能
  - タスク: 目標BPMへの段階的誘導アルゴリズム
- [ ] 🌱 データ記録とエクスポート機能
  - タスク: フラッシュメモリへのログ記録
  - タスク: シリアル経由のログエクスポート
- [ ] 🌱 バッテリー管理と省電力モード
  - タスク: バッテリー残量表示
  - タスク: 低電力モード実装

## 最適化
- [ ] ⚡ IMUセンサーのサンプリングレート最適化
  - タスク: 最適なサンプリングレート設定（バッテリー寿命vs精度）
- [ ] ⚡ メモリ使用量の削減
  - タスク: バッファサイズの最適化
  - タスク: 静的メモリ割り当ての見直し
- [ ] ⚡ バッテリー持続時間の最適化（スリープモード実装）
  - タスク: 処理間のマイクロ秒スリープ導入
- [ ] 🌱 ローパスフィルタのパラメータ調整
  - タスク: ノイズ除去と応答性のバランス最適化

## UI改善
- [ ] 🌱 初期化画面の改善
  - タスク: 起動時のロゴとステータス表示
- [ ] 🌱 メイン画面のレイアウト最適化
  - タスク: BPM、ステップ数、動作モードなど情報配置の改善
- [ ] 🌱 グラフ表示の視認性向上
  - タスク: 軸ラベルと目盛りの追加
  - タスク: カラースキームの最適化
- [ ] 🌱 エラーメッセージの改善
  - タスク: エラーコードと詳細説明の表示

## テスト・評価
- [ ] ⚡ IMUセンサーキャリブレーション
  - タスク: 静止状態でのオフセット補正
- [ ] ⚡ BPM検出精度評価
  - タスク: 既知のリズムパターンでの検出率測定
- [ ] 🌱 バッテリー持続時間評価
  - タスク: 各機能有効時の消費電力測定
- [ ] 🌱 実環境での歩行テスト
  - タスク: 異なる歩行ペースでの検出精度確認

## ドキュメント
- [ ] 🌱 操作マニュアル作成
  - タスク: ユーザー向け基本操作説明書
- [ ] 🌱 開発ドキュメント更新
  - タスク: コード構造とアルゴリズム解説
- [ ] 🌱 技術仕様書作成
  - タスク: ハードウェア/ソフトウェア仕様書

---

## 進捗状況
現在の焦点は、BMI270センサーの正しい初期化とボタン処理のクラッシュ問題解決に置かれています。これらの基本的なハードウェアインターフェースの問題が解決されれば、歩行検出とBPM計算の機能実装に移行できます。

進捗状況をチェックボックスに記録し、開発を進めてください。
コミットメッセージには実装した機能や修正した箇所を明記してください。